<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preparison of gene sets (annoData) • BrainEnrich</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparison of gene sets (annoData)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BrainEnrich</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/annoData_demo.html">Preparison of gene sets (annoData)</a></li>
    <li><a class="dropdown-item" href="../articles/brainenrich_demo.html">Group-level Enrichment Analysis (brainenrich)</a></li>
    <li><a class="dropdown-item" href="../articles/brainscore_demo.html">Individual-level enrichment analysis (brainscore/brainscore.lm_test)</a></li>
    <li><a class="dropdown-item" href="../articles/brainscore.simulate_demo.html">Simulation analysis (brainscore.simulate)</a></li>
    <li><a class="dropdown-item" href="../articles/hpc_demo.html">Computation on HPC with slurm</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="annoData_demo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Preparison of gene sets (annoData)</h1>
            
      

      <div class="d-none name"><code>annoData_demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>annoData</code> object, from DOSE parckage, is a list containing two data frames: TERM2GENE and TERM2NAME. The TERM2GENE data frame contains the mapping of gene IDs to terms, while the TERM2NAME data frame contains the mapping of terms to their descriptions.</p>
<p>The documentation details the preparation of gene sets (annoData) and guides users on generating gene sets from various sources (e.g., gmt, csv). Users can create their own to match their research interests.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"BiocManager"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">bioc_packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"org.Hs.eg.db"</span>, <span class="st">"clusterProfiler"</span>, <span class="st">"DOSE"</span>, <span class="st">"ReactomePA"</span>, <span class="st">"reactome.db"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">pkg</span> <span class="kw">in</span> <span class="va">bioc_packages</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="va">pkg</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">clusterProfiler</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/contribution-knowledge-mining/" class="external-link">DOSE</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ReactomePA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">reactome.db</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zh1peng.github.io/BrainEnrich/" class="external-link">BrainEnrich</a></span><span class="op">)</span></span>
<span><span class="va">build_Anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"build_Anno"</span>, <span class="st">"DOSE"</span><span class="op">)</span></span></code></pre></div>
<p>Since we may need to convert geneID to symbols, we first define helper functions for it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">symbol_annoData</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_Anno.html">split_Anno</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span>  <span class="va">path2gene</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">path2gene</span></span>
<span>  <span class="va">path2name</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">$</span><span class="va">path2name</span></span>
<span>  <span class="va">geneIDs</span> <span class="op">&lt;-</span> <span class="va">path2gene</span><span class="op">$</span><span class="va">geneID</span></span>
<span>  <span class="va">entrez_ids</span> <span class="op">&lt;-</span> <span class="fu">AnnotationDbi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html" class="external-link">keys</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span>  <span class="va">matching_ids</span> <span class="op">&lt;-</span> <span class="va">geneIDs</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">entrez_ids</span></span>
<span>  <span class="va">percentage_match</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">matching_ids</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geneIDs</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">90</span> <span class="co"># For example, 80% match</span></span>
<span>  <span class="va">is_mostly_entrez</span> <span class="op">&lt;-</span> <span class="va">percentage_match</span> <span class="op">&gt;=</span> <span class="va">threshold</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">is_mostly_entrez</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">gene_symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html" class="external-link">mapIds</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span>, keys <span class="op">=</span> <span class="va">geneIDs</span>, column <span class="op">=</span> <span class="st">"SYMBOL"</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span>, multiVals <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The gene IDs are not mostly ENTREZID. Attempting to convert to ENTREZID..."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">gene_symbols</span><span class="op">)</span> <span class="op">!=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geneIDs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Failed to convert gene IDs in the data frame to SYMBOL."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">path2gene</span><span class="op">$</span><span class="va">geneID</span> <span class="op">&lt;-</span> <span class="va">gene_symbols</span></span>
<span>  <span class="va">path2gene</span> <span class="op">&lt;-</span> <span class="va">path2gene</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">path2gene</span><span class="op">$</span><span class="va">geneID</span><span class="op">)</span> <span class="op">|</span> <span class="va">path2gene</span><span class="op">$</span><span class="va">geneID</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">build_Anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"build_Anno"</span>, <span class="st">"DOSE"</span><span class="op">)</span></span>
<span>  <span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">build_Anno</span><span class="op">(</span><span class="va">path2gene</span>, <span class="va">path2name</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Alternative approach to convert gene IDs to symbols</span></span>
<span><span class="co"># #' Convert Entrez IDs to Gene Symbols</span></span>
<span><span class="co"># #'</span></span>
<span><span class="co"># #' This function converts a vector of Entrez IDs to gene symbols using the org.Hs.eg.db annotation package.</span></span>
<span><span class="co"># #'</span></span>
<span><span class="co"># #' @param entrezid A vector of Entrez IDs to be converted to gene symbols.</span></span>
<span><span class="co"># #' @return A vector of gene symbols corresponding to the input Entrez IDs.</span></span>
<span><span class="co"># #' @importFrom AnnotationDbi mapIds</span></span>
<span><span class="co"># #' @export</span></span>
<span><span class="co"># entrezid2symbol &lt;- function(entrezid) {</span></span>
<span><span class="co">#   # Ensure input is character vector</span></span>
<span><span class="co">#   entrezid &lt;- as.character(entrezid)</span></span>
<span></span>
<span><span class="co">#   # Map Entrez IDs to gene symbols</span></span>
<span><span class="co">#   mappedSymbol &lt;- suppressMessages(</span></span>
<span><span class="co">#     mapIds(</span></span>
<span><span class="co">#       x = org.Hs.eg.db,</span></span>
<span><span class="co">#       keys = entrezid,</span></span>
<span><span class="co">#       keytype = "ENTREZID",</span></span>
<span><span class="co">#       column = "SYMBOL",</span></span>
<span><span class="co">#       multiVals = "first"</span></span>
<span><span class="co">#     )</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co">#   # Remove NA values and attributes</span></span>
<span><span class="co">#   mappedSymbol &lt;- na.omit(mappedSymbol)</span></span>
<span><span class="co">#   attributes(mappedSymbol) &lt;- NULL</span></span>
<span><span class="co">#   return(unname(mappedSymbol))</span></span>
<span><span class="co"># }</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gene-ontology-go-gene-sets-from-org-hs-eg-db">Gene ontology (GO) gene sets from org.Hs.eg.db<a class="anchor" aria-label="anchor" href="#gene-ontology-go-gene-sets-from-org-hs-eg-db"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_GO_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"get_GO_data"</span>, <span class="st">"clusterProfiler"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_GO_data</span><span class="op">(</span><span class="st">"org.Hs.eg.db"</span>, ont <span class="op">=</span> <span class="st">"BP"</span>, keytype <span class="op">=</span> <span class="st">"SYMBOL"</span><span class="op">)</span></span>
<span><span class="co"># saveRDS(annoData, file = "extdata/geneSets/GO_BP.rds", compress = "xz")</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_GO_data</span><span class="op">(</span><span class="st">"org.Hs.eg.db"</span>, ont <span class="op">=</span> <span class="st">"MF"</span>, keytype <span class="op">=</span> <span class="st">"SYMBOL"</span><span class="op">)</span></span>
<span><span class="co"># saveRDS(annoData, file = "extdata/geneSets/GO_MF.rds", compress = "xz")</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_GO_data</span><span class="op">(</span><span class="st">"org.Hs.eg.db"</span>, ont <span class="op">=</span> <span class="st">"CC"</span>, keytype <span class="op">=</span> <span class="st">"SYMBOL"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/GO_CC.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check version of org.Hs.eg.db</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"clusterProfiler"</span><span class="op">)</span> <span class="co"># '4.12.0'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"org.Hs.eg.db"</span><span class="op">)</span> <span class="co"># '3.19.1'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="disgenet-gene-sets-using-get_dgn_data-from-dose-package">DisGeNET gene sets using get_DGN_data from DOSE package<a class="anchor" aria-label="anchor" href="#disgenet-gene-sets-using-get_dgn_data-from-dose-package"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_DGN_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"get_DGN_data"</span>, <span class="st">"DOSE"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_DGN_data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span><span class="st">"C0001546"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/DGN.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"DOSE"</span><span class="op">)</span> <span class="co"># '3.30.1'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"AnnotationDbi"</span><span class="op">)</span> <span class="co"># '1.66.0'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="kegg-modules-using-get_kegg_data-from-clusterprofiler-package">KEGG modules using get_KEGG_data from clusterProfiler package<a class="anchor" aria-label="anchor" href="#kegg-modules-using-get_kegg_data-from-clusterprofiler-package"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_KEGG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"prepare_KEGG"</span>, <span class="st">"clusterProfiler"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">prepare_KEGG</span><span class="op">(</span><span class="st">"hsa"</span>, <span class="st">"MKEGG"</span>, <span class="st">"ncbi-geneid"</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span><span class="st">"M00124"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/MKEGG.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"clusterProfiler"</span><span class="op">)</span> <span class="co"># '4.12.0'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="kegg-pathways-using-get_kegg_data-from-clusterprofiler-package">KEGG pathways using get_KEGG_data from clusterProfiler package<a class="anchor" aria-label="anchor" href="#kegg-pathways-using-get_kegg_data-from-clusterprofiler-package"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_KEGG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"prepare_KEGG"</span>, <span class="st">"clusterProfiler"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">prepare_KEGG</span><span class="op">(</span><span class="st">"hsa"</span>, <span class="st">"KEGG"</span>, <span class="st">"ncbi-geneid"</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span><span class="st">"hsa03008"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/KEGG.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"clusterProfiler"</span><span class="op">)</span> <span class="co"># '4.12.0'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wikipathways-using-get_wp_data-from-clusterprofiler-package">WikiPathways using get_WP_data from clusterProfiler package<a class="anchor" aria-label="anchor" href="#wikipathways-using-get_wp_data-from-clusterprofiler-package"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepare_WP_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"prepare_WP_data"</span>, <span class="st">"clusterProfiler"</span><span class="op">)</span></span>
<span><span class="va">wpdata</span> <span class="op">&lt;-</span> <span class="fu">prepare_WP_data</span><span class="op">(</span><span class="st">"Homo sapiens"</span><span class="op">)</span></span>
<span><span class="va">TERM2GENE</span> <span class="op">&lt;-</span> <span class="va">wpdata</span><span class="op">$</span><span class="va">WPID2GENE</span></span>
<span><span class="va">TERM2NAME</span> <span class="op">&lt;-</span> <span class="va">wpdata</span><span class="op">$</span><span class="va">WPID2NAME</span></span>
<span><span class="va">build_Anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"build_Anno"</span>, <span class="st">"DOSE"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">build_Anno</span><span class="op">(</span><span class="va">TERM2GENE</span>, <span class="va">TERM2NAME</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span><span class="st">"WP2338"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/WikiPathways.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"clusterProfiler"</span><span class="op">)</span> <span class="co"># '4.12.0'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reactome-using-get_reactome_data-from-reactomepa-package">Reactome using get_Reactome_DATA from ReactomePA package<a class="anchor" aria-label="anchor" href="#reactome-using-get_reactome_data-from-reactomepa-package"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_Reactome_DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"get_Reactome_DATA"</span>, <span class="st">"ReactomePA"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_Reactome_DATA</span><span class="op">(</span><span class="st">"human"</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span><span class="st">"R-HSA-1059683"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/Reactome.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"ReactomePA"</span><span class="op">)</span> <span class="co"># '1.48.0'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="syngo-from-xlsx-file-downloaded-from-syngo-website">SynGO from xlsx file downloaded from SynGO website<a class="anchor" aria-label="anchor" href="#syngo-from-xlsx-file-downloaded-from-syngo-website"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define URL for downloading SynGO data</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.syngoportal.org/data/SynGO_bulk_download_release_20231201.zip"</span></span>
<span><span class="co"># Create temporary file and directory</span></span>
<span><span class="va">zip_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".zip"</span><span class="op">)</span></span>
<span><span class="va">temp_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Clean-up function to ensure temp files are removed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">zip_path</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">zip_path</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">extracted_file</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">extracted_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">extracted_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">temp_dir</span>, <span class="st">"syngo_ontologies.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">zip_path</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="va">zip_path</span>, files <span class="op">=</span> <span class="st">"syngo_ontologies.xlsx"</span>, exdir <span class="op">=</span> <span class="va">temp_dir</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Read the data from the extracted file</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">extracted_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process TERM2GENE</span></span>
<span><span class="va">TERM2GENE</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">hgnc_symbol</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>term <span class="op">=</span> <span class="va">id</span>, gene <span class="op">=</span> <span class="va">hgnc_symbol</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">gene</span>, <span class="st">", "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Process TERM2NAME</span></span>
<span><span class="va">TERM2NAME</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>term <span class="op">=</span> <span class="va">id</span>, description <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use build_Anno function from DOSE package</span></span>
<span><span class="va">build_Anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/getFromNamespace.html" class="external-link">getFromNamespace</a></span><span class="op">(</span><span class="st">"build_Anno"</span>, <span class="st">"DOSE"</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">build_Anno</span><span class="op">(</span><span class="va">TERM2GENE</span>, <span class="va">TERM2NAME</span><span class="op">)</span></span>
<span><span class="co"># saveRDS(annoData, file = "extdata/geneSets/SynGO.rds",compress='xz')</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="celltypes_seidlitz2020-from-csv-file-downloaded-from-github">CellTypes_Seidlitz2020 from csv file downloaded from github<a class="anchor" aria-label="anchor" href="#celltypes_seidlitz2020-from-csv-file-downloaded-from-github"></a>
</h2>
<p>Ref: Seidlitz, J., Nadig, A., Liu, S., Bethlehem, R. A., Vértes, P. E., Morgan, S. E., … &amp; Raznahan, A. (2020). Transcriptomic and cellular decoding of regional brain vulnerability to neurogenetic disorders. Nature communications, 11(1), 3358.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co"># Define URL for Seidlitz2020</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/jms290/PolySyn_MSNs/blob/master/Data/AHBA/celltypes_PSP.csv?raw=true"</span></span>
<span></span>
<span><span class="co"># Create temporary file</span></span>
<span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Clean-up function to ensure temp files are removed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">temp_file</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read CSV file</span></span>
<span><span class="va">TERM2GENE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>term <span class="op">=</span> <span class="va">class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">gene</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">gene</span><span class="op">)</span></span>
<span></span>
<span><span class="va">key_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Astro"</span> <span class="op">=</span> <span class="st">"Astrocytes"</span>,</span>
<span>  <span class="st">"Endo"</span> <span class="op">=</span> <span class="st">"Endothelial"</span>,</span>
<span>  <span class="st">"Micro"</span> <span class="op">=</span> <span class="st">"Microglial"</span>,</span>
<span>  <span class="st">"OPC"</span> <span class="op">=</span> <span class="st">"Oligodendrocyte Progenitors"</span>,</span>
<span>  <span class="st">"Neuro-Ex"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons"</span>,</span>
<span>  <span class="st">"Neuro-In"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons"</span>,</span>
<span>  <span class="st">"Oligo"</span> <span class="op">=</span> <span class="st">"Oligodendrocytes"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">TERM2NAME</span> <span class="op">&lt;-</span> <span class="va">TERM2GENE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>description <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">term</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">key_dict</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">description</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">build_Anno</span><span class="op">(</span><span class="va">TERM2GENE</span>, <span class="va">TERM2NAME</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span>term <span class="op">=</span> <span class="st">"Astro"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/CellTypes_Seidlitz2020.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="celltypes_lake2018-from-a-gmt-file-downloaded-from-github">CellTypes_Lake2018 from a gmt file downloaded from github<a class="anchor" aria-label="anchor" href="#celltypes_lake2018-from-a-gmt-file-downloaded-from-github"></a>
</h2>
<p>Ref: Lake, B. B., Chen, S., Sos, B. C., Fan, J., Kaeser, G. E., Yung, Y. C., … &amp; Zhang, K. (2018). Integrative single-cell analysis of transcriptional and epigenetic states in the human adult brain. Nature biotechnology, 36(1), 70-80.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define URL for Lake2018</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/molecular-neuroimaging/Imaging_Transcriptomics/raw/main/imaging_transcriptomics/data/geneset_LAKE.gmt"</span></span>
<span><span class="co"># Create temporary file</span></span>
<span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Clean-up function to ensure temp files are removed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">temp_file</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="co"># Read GMT file</span></span>
<span><span class="va">TERM2GENE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu">read.gmt</span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">gene</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">gene</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">key_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># Excitatory Neurons</span></span>
<span>  <span class="st">"Ex1"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 1"</span>,</span>
<span>  <span class="st">"Ex2"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 2"</span>,</span>
<span>  <span class="st">"Ex3a"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 3a"</span>,</span>
<span>  <span class="st">"Ex3b"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 3b"</span>,</span>
<span>  <span class="st">"Ex3c"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 3c"</span>,</span>
<span>  <span class="st">"Ex3d"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 3d"</span>,</span>
<span>  <span class="st">"Ex3e"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 3e"</span>,</span>
<span>  <span class="st">"Ex4"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 4"</span>,</span>
<span>  <span class="st">"Ex5a"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 5a"</span>,</span>
<span>  <span class="st">"Ex5b"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 5b"</span>,</span>
<span>  <span class="st">"Ex6a"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 6a"</span>,</span>
<span>  <span class="st">"Ex6b"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 6b"</span>,</span>
<span>  <span class="st">"Ex8"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons 8"</span>,</span>
<span></span>
<span>  <span class="co"># Granule Cells (Cerebellar)</span></span>
<span>  <span class="st">"Gran"</span> <span class="op">=</span> <span class="st">"Cerebellar Granule Cells"</span>,</span>
<span></span>
<span>  <span class="co"># Inhibitory Neurons</span></span>
<span>  <span class="st">"In1a"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 1a"</span>,</span>
<span>  <span class="st">"In1b"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 1b"</span>,</span>
<span>  <span class="st">"In1c"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 1c"</span>,</span>
<span>  <span class="st">"In2"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 2"</span>,</span>
<span>  <span class="st">"In3"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 3"</span>,</span>
<span>  <span class="st">"In4a"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 4a"</span>,</span>
<span>  <span class="st">"In4b"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 4b"</span>,</span>
<span>  <span class="st">"In6a"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 6a"</span>,</span>
<span>  <span class="st">"In6b"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 6b"</span>,</span>
<span>  <span class="st">"In7"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 7"</span>,</span>
<span>  <span class="st">"In8"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons 8"</span>,</span>
<span></span>
<span>  <span class="co"># Purkinje Cells (Cerebellar Neurons)</span></span>
<span>  <span class="st">"Purk1"</span> <span class="op">=</span> <span class="st">"Purkinje Cells 1"</span>,</span>
<span>  <span class="st">"Purk2"</span> <span class="op">=</span> <span class="st">"Purkinje Cells 2"</span>,</span>
<span></span>
<span>  <span class="co"># Non-Neuronal Cells</span></span>
<span>  <span class="st">"End"</span> <span class="op">=</span> <span class="st">"Endothelial Cells"</span>,</span>
<span>  <span class="st">"Per"</span> <span class="op">=</span> <span class="st">"Pericytes/Smooth Muscle Cells"</span>,</span>
<span>  <span class="st">"Ast"</span> <span class="op">=</span> <span class="st">"Astrocytes"</span>,</span>
<span>  <span class="st">"Ast_Cer"</span> <span class="op">=</span> <span class="st">"Cerebellar Astrocytes"</span>,</span>
<span>  <span class="st">"Oli"</span> <span class="op">=</span> <span class="st">"Oligodendrocytes"</span>,</span>
<span>  <span class="st">"OPC"</span> <span class="op">=</span> <span class="st">"Oligodendrocyte Progenitor Cells"</span>,</span>
<span>  <span class="st">"OPC_Cer"</span> <span class="op">=</span> <span class="st">"Cerebellar OPCs"</span>,</span>
<span>  <span class="st">"Mic"</span> <span class="op">=</span> <span class="st">"Microglia"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">TERM2NAME</span> <span class="op">&lt;-</span> <span class="va">TERM2GENE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>description <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">term</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">key_dict</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">description</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TERM2NAME</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">build_Anno</span><span class="op">(</span><span class="va">TERM2GENE</span>, <span class="va">TERM2NAME</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span>term <span class="op">=</span> <span class="st">"Ast"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/CellTypes_Lake2018.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="celltypes_martins2021-from-a-gmt-file-downloaded-from-github">CellTypes_Martins2021 from a gmt file downloaded from github<a class="anchor" aria-label="anchor" href="#celltypes_martins2021-from-a-gmt-file-downloaded-from-github"></a>
</h2>
<p>Ref: Imaging transcriptomics: Convergent cellular, transcriptomic, and molecular neuroimaging signatures in the healthy adult human brain. Daniel Martins, Alessio Giacomel, Steven CR Williams, Federico Turkheimer, Ottavia Dipasquale, Mattia Veronese, PET templates working group. Cell Reports.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define URL for Martins2021</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/molecular-neuroimaging/Imaging_Transcriptomics/raw/main/imaging_transcriptomics/data/geneset_Pooled.gmt"</span></span>
<span><span class="co"># Create temporary file</span></span>
<span><span class="va">temp_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Clean-up function to ensure temp files are removed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span></span>
<span>  <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span><span class="va">url</span>, <span class="va">temp_file</span>, mode <span class="op">=</span> <span class="st">"wb"</span><span class="op">)</span></span>
<span><span class="co"># Read GMT file</span></span>
<span><span class="va">TERM2GENE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">clusterProfiler</span><span class="fu">::</span><span class="fu">read.gmt</span><span class="op">(</span><span class="va">temp_file</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">gene</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">gene</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">key_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"Astro"</span> <span class="op">=</span> <span class="st">"Astrocytes"</span>,</span>
<span>  <span class="st">"Endo"</span> <span class="op">=</span> <span class="st">"Endothelial Cells"</span>,</span>
<span>  <span class="st">"Microglia"</span> <span class="op">=</span> <span class="st">"Microglial Cells"</span>,</span>
<span>  <span class="st">"Neuro_Exc"</span> <span class="op">=</span> <span class="st">"Excitatory Neurons"</span>,</span>
<span>  <span class="st">"Neuro_Inb"</span> <span class="op">=</span> <span class="st">"Inhibitory Neurons"</span>,</span>
<span>  <span class="st">"Oligo"</span> <span class="op">=</span> <span class="st">"Oligodendrocytes"</span>,</span>
<span>  <span class="st">"OPC"</span> <span class="op">=</span> <span class="st">"Oligodendrocyte Progenitor Cells"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">TERM2NAME</span> <span class="op">&lt;-</span> <span class="va">TERM2GENE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>description <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">term</span>, <span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">key_dict</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">description</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">TERM2NAME</span><span class="op">)</span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">build_Anno</span><span class="op">(</span><span class="va">TERM2GENE</span>, <span class="va">TERM2NAME</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span>term <span class="op">=</span> <span class="st">"Astro"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/CellTypes_Martins2021.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mesh">MeSH<a class="anchor" aria-label="anchor" href="#mesh"></a>
</h2>
<p>First we define a function to prepare the MeSH data</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_MeSH_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">MeSH.hsa.db</span>, <span class="va">MeSH.db</span>, <span class="va">database</span>, <span class="va">category</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">category</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span></span>
<span>  <span class="va">categories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>,</span>
<span>    <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>,</span>
<span>    <span class="st">"I"</span>, <span class="st">"J"</span>, <span class="st">"K"</span>, <span class="st">"L"</span>,</span>
<span>    <span class="st">"M"</span>, <span class="st">"N"</span>, <span class="st">"V"</span>, <span class="st">"Z"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">category</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">categories</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"please check your 'category' parameter..."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">mesh</span> <span class="op">&lt;-</span> <span class="fu">AnnotationDbi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html" class="external-link">select</a></span><span class="op">(</span><span class="va">MeSH.hsa.db</span>, keys <span class="op">=</span> <span class="va">database</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GENEID"</span>, <span class="st">"MESHID"</span>, <span class="st">"MESHCATEGORY"</span><span class="op">)</span>, keytype <span class="op">=</span> <span class="st">"SOURCEDB"</span><span class="op">)</span></span>
<span>  <span class="va">mesh</span> <span class="op">&lt;-</span> <span class="va">mesh</span><span class="op">[</span><span class="va">mesh</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">category</span>, <span class="op">]</span></span>
<span>  <span class="va">mesh2gene</span> <span class="op">&lt;-</span> <span class="va">mesh</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">mesh2name</span> <span class="op">&lt;-</span> <span class="fu">AnnotationDbi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html" class="external-link">select</a></span><span class="op">(</span><span class="va">MeSH.db</span>, keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mesh2gene</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MESHID"</span>, <span class="st">"MESHTERM"</span><span class="op">)</span>, keytype <span class="op">=</span> <span class="st">"MESHID"</span><span class="op">)</span></span>
<span>  <span class="fu">build_Anno</span><span class="op">(</span><span class="va">mesh2gene</span>, <span class="va">mesh2name</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"AnnotationHub"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"MeSHDbi"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AnnotationHub</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MeSHDbi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare MeSH.hsa.db (it is a gene-MeSH db)</span></span>
<span><span class="va">ah</span> <span class="op">&lt;-</span> <span class="fu">AnnotationHub</span><span class="op">(</span>cache <span class="op">=</span> <span class="st">"C:/Users/Zhipeng/AppData/Local/Temp/Rtmpe24TtF/BiocFileCache"</span>, localHub <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># localHub=TRUE if you have downloaded the data</span></span>
<span><span class="va">hsa</span> <span class="op">&lt;-</span> <span class="fu">query</span><span class="op">(</span><span class="va">ah</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MeSHDb"</span>, <span class="st">"Homo sapiens"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">file_hsa</span> <span class="op">&lt;-</span> <span class="va">hsa</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">MeSH.hsa.db</span> <span class="op">&lt;-</span> <span class="fu">MeSHDbi</span><span class="fu">::</span><span class="fu">MeSHDb</span><span class="op">(</span><span class="va">file_hsa</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare MeSH.db (it is a name db)</span></span>
<span><span class="va">ah</span> <span class="op">&lt;-</span> <span class="fu">AnnotationHub</span><span class="op">(</span>localHub <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># cache="C:/Users/Zhipeng/AppData/Local/R/cache/R/AnnotationHub/205c177937a_98389"</span></span>
<span><span class="va">dbfile1</span> <span class="op">&lt;-</span> <span class="fu">query</span><span class="op">(</span><span class="va">ah</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MeSHDb"</span>, <span class="st">"MeSH.db"</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">MeSH.db</span> <span class="op">&lt;-</span> <span class="fu">MeSHDbi</span><span class="fu">::</span><span class="fu">MeSHDb</span><span class="op">(</span><span class="va">dbfile1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_MeSH_data</span><span class="op">(</span>MeSH.hsa.db <span class="op">=</span> <span class="va">MeSH.hsa.db</span>, MeSH.db <span class="op">=</span> <span class="va">MeSH.db</span>, database <span class="op">=</span> <span class="st">"gene2pubmed"</span>, category <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></span>
<span><span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_termDescription.html">get_termDescription</a></span><span class="op">(</span>term <span class="op">=</span> <span class="st">"D003071"</span>, <span class="va">annoData</span><span class="op">)</span></span>
<span></span>
<span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="st">"inst/extdata/geneSets/test.rds"</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span></code></pre></div>
<p>After figure out for one category, we can make it a loop for gene2pubmed</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">cat_i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span>, <span class="st">"F"</span>, <span class="st">"G"</span>, <span class="st">"H"</span>, <span class="st">"I"</span>, <span class="st">"J"</span>, <span class="st">"K"</span>, <span class="st">"L"</span>, <span class="st">"M"</span>, <span class="st">"N"</span>, <span class="st">"V"</span>, <span class="st">"Z"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Preparing category: "</span>, <span class="va">cat_i</span><span class="op">)</span></span>
<span>  <span class="co"># Fetching the MeSH data for the specified category</span></span>
<span>  <span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">get_MeSH_data</span><span class="op">(</span>MeSH.hsa.db <span class="op">=</span> <span class="va">MeSH.hsa.db</span>, MeSH.db <span class="op">=</span> <span class="va">MeSH.db</span>, database <span class="op">=</span> <span class="st">"gene2pubmed"</span>, category <span class="op">=</span> <span class="va">cat_i</span><span class="op">)</span></span>
<span>  <span class="va">geneSetList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geneSetList</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"No gene set found for category: "</span>, <span class="va">cat_i</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Converting gene IDs to gene symbols for category: "</span>, <span class="va">cat_i</span><span class="op">)</span></span>
<span>    <span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu">symbol_annoData</span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Saving annoData for category: "</span>, <span class="va">cat_i</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">annoData</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"inst/extdata/geneSets/MeSH_"</span>, <span class="va">cat_i</span>, <span class="st">".rds"</span><span class="op">)</span>, compress <span class="op">=</span> <span class="st">"xz"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhipeng Cao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
