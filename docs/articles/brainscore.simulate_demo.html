<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulation analysis of brainscore • BrainEnrich</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulation analysis of brainscore">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BrainEnrich</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/brainenrich_demo.html">brainenrich (demo):Enrichment analysis of group-level IDPs</a></li>
    <li><a class="dropdown-item" href="../articles/brainscore.simulate_demo.html">Simulation analysis of brainscore</a></li>
    <li><a class="dropdown-item" href="../articles/brainscore_demo.html">Enrichment analysis of individual-level IDPs</a></li>
    <li><a class="dropdown-item" href="../articles/hpc_helper_demo.html">How to precompute null gene set scores and do simulation on HPC with slurm</a></li>
    <li><a class="dropdown-item" href="../articles/prepare_annoDat.html">How to prepare gene sets (annoDat) for the analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulation analysis of brainscore</h1>
            
      

      <div class="d-none name"><code>brainscore.simulate_demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial demonstrates how to perform do simulation to assess the
false positive rate of analysis with brainscore. The
<code>brainscore</code> function calculates the gene set scores and
correlates them with the predictor variable. The simulation analysis is
performed by * (1) permuting the predictor variable
(<code>sim_type ='randomize_pred'</code>); * (2) simulating the brain
data by spinning it (<code>sim_type ='spin_brain'</code>); * (3)
resampling the genes (<code>sim_type ='resampling_gene'</code>). The
simulation analysis is performed to assess the false positive rate of
the analysis, as when the above elements are permuted, we expect no the
correlation between the gene set scores and the predictor variable. For
demonstration purposes, we have used a small number of iterations (sim_n
= 5) and one subsample size (subsample_size = 100). In practice, we
recommend using a larger number of iterations (i.e. 1000), various
subsample sizes (e.g., 50, 100, 150, 200) and larger size of null models
for a more robust analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zh1peng.github.io/BrainEnrich/" class="external-link">BrainEnrich</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/biomedical-knowledge-mining-book/" class="external-link">enrichplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-data-for-the-analysis">1. Prepare Data for the Analysis<a class="anchor" aria-label="anchor" href="#prepare-data-for-the-analysis"></a>
</h2>
<p>First, we will prepare the data needed for enrichment analysis. The
data is simulated (not real data) from the HCP dataset, and we’ll be
using various pre-defined gene sets from SynGO and brain data for
analysis.</p>
<div class="section level3">
<h3 id="load-sample-data-simulated-from-hcp-data-">1.1. Load sample data simulated from HCP data.<a class="anchor" aria-label="anchor" href="#load-sample-data-simulated-from-hcp-data-"></a>
</h3>
<p>The data is simulated from HCP data. Let’s load and inspect it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sample_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sample_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    100 obs. of  37 variables:</span></span>
<span><span class="co">#&gt;  $ L_bankssts                : num  2.44 2.46 2.36 2.59 2.35 ...</span></span>
<span><span class="co">#&gt;  $ L_caudalanteriorcingulate : num  2.57 2.29 2.67 2.84 2.14 ...</span></span>
<span><span class="co">#&gt;  $ L_caudalmiddlefrontal     : num  2.58 2.53 2.85 2.85 2.32 ...</span></span>
<span><span class="co">#&gt;  $ L_cuneus                  : num  2.01 1.98 1.85 1.89 1.93 ...</span></span>
<span><span class="co">#&gt;  $ L_entorhinal              : num  3.37 3.47 2.77 3.19 2.73 ...</span></span>
<span><span class="co">#&gt;  $ L_fusiform                : num  2.73 2.67 2.5 2.67 2.44 ...</span></span>
<span><span class="co">#&gt;  $ L_inferiorparietal        : num  2.45 2.43 2.53 2.62 2.39 ...</span></span>
<span><span class="co">#&gt;  $ L_inferiortemporal        : num  2.68 2.98 2.69 2.92 2.6 ...</span></span>
<span><span class="co">#&gt;  $ L_isthmuscingulate        : num  2.46 2.18 2.82 2.24 2.66 ...</span></span>
<span><span class="co">#&gt;  $ L_lateraloccipital        : num  2.23 2.26 2.33 2.17 2.05 ...</span></span>
<span><span class="co">#&gt;  $ L_lateralorbitofrontal    : num  2.67 2.67 2.9 2.68 2.54 ...</span></span>
<span><span class="co">#&gt;  $ L_lingual                 : num  2.01 2.16 1.99 2.09 2.05 ...</span></span>
<span><span class="co">#&gt;  $ L_medialorbitofrontal     : num  2.18 2.54 2.46 2.33 2.16 ...</span></span>
<span><span class="co">#&gt;  $ L_middletemporal          : num  2.86 2.91 2.77 3.05 2.82 ...</span></span>
<span><span class="co">#&gt;  $ L_parahippocampal         : num  2.65 3.02 2.39 2.66 3.1 ...</span></span>
<span><span class="co">#&gt;  $ L_paracentral             : num  2.47 2.37 2.46 2.65 2.35 ...</span></span>
<span><span class="co">#&gt;  $ L_parsopercularis         : num  2.48 2.7 2.89 2.73 2.46 ...</span></span>
<span><span class="co">#&gt;  $ L_parsorbitalis           : num  2.81 2.75 2.99 2.99 2.47 ...</span></span>
<span><span class="co">#&gt;  $ L_parstriangularis        : num  2.43 2.61 2.75 2.46 2.32 ...</span></span>
<span><span class="co">#&gt;  $ L_pericalcarine           : num  1.67 1.91 1.8 1.73 1.79 ...</span></span>
<span><span class="co">#&gt;  $ L_postcentral             : num  2.16 2.1 2.17 2.22 2.14 ...</span></span>
<span><span class="co">#&gt;  $ L_posteriorcingulate      : num  2.37 2.32 2.76 2.64 2.29 ...</span></span>
<span><span class="co">#&gt;  $ L_precentral              : num  2.61 2.65 2.79 2.67 2.47 ...</span></span>
<span><span class="co">#&gt;  $ L_precuneus               : num  2.37 2.3 2.39 2.5 2.24 ...</span></span>
<span><span class="co">#&gt;  $ L_rostralanteriorcingulate: num  2.25 3 3.01 2.63 2.42 ...</span></span>
<span><span class="co">#&gt;  $ L_rostralmiddlefrontal    : num  2.44 2.42 2.63 2.58 2.23 ...</span></span>
<span><span class="co">#&gt;  $ L_superiorfrontal         : num  2.81 2.76 2.91 2.97 2.57 ...</span></span>
<span><span class="co">#&gt;  $ L_superiorparietal        : num  2.22 2.18 2.29 2.36 2.11 ...</span></span>
<span><span class="co">#&gt;  $ L_superiortemporal        : num  2.75 3.1 2.63 2.81 2.86 ...</span></span>
<span><span class="co">#&gt;  $ L_supramarginal           : num  2.65 2.55 2.56 2.63 2.51 ...</span></span>
<span><span class="co">#&gt;  $ L_frontalpole             : num  2.92 2.8 2.93 3.26 2.7 ...</span></span>
<span><span class="co">#&gt;  $ L_temporalpole            : num  4.05 3.5 3.92 3.11 3.2 ...</span></span>
<span><span class="co">#&gt;  $ L_transversetemporal      : num  2.59 2.8 2.26 2.61 2.61 ...</span></span>
<span><span class="co">#&gt;  $ L_insula                  : num  2.94 2.94 3 3.18 2.74 ...</span></span>
<span><span class="co">#&gt;  $ Age                       : int  36 36 29 24 31 28 29 29 26 25 ...</span></span>
<span><span class="co">#&gt;  $ Sex                       : Factor w/ 2 levels "0","1": 1 1 1 2 2 2 1 1 1 2 ...</span></span>
<span><span class="co">#&gt;  $ BMI                       : num  25.2 24.9 23 26 25.4 ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-brain_data-for-scoring">1.2. prepare brain_data for scoring<a class="anchor" aria-label="anchor" href="#prepare-brain_data-for-scoring"></a>
</h3>
<p>Next, we’ll prepare the brain data by selecting the relevant columns
and transforming the data for scoring.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">brain_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_df</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"L_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">brain_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sub-"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">brain_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">brain_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:34, 1:100] 2.44 2.57 2.58 2.01 3.37 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:34] "L_bankssts" "L_caudalanteriorcingulate" "L_caudalmiddlefrontal" "L_cuneus" ...</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:100] "sub-1" "sub-2" "sub-3" "sub-4" ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-gene-expression-data-for-the-analysis">1.3. Load gene expression data for the Analysis<a class="anchor" aria-label="anchor" href="#load-gene-expression-data-for-the-analysis"></a>
</h3>
<p>We will now load gene expression data for the analysis. This data is
based on a specific brain atlas (Desikan) and includes gene expression
levels (correlation across donnors &gt; 0.4) for the left
hemisphere.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gene_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneExp.html">get_geneExp</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="st">"desikan"</span>, rdonor <span class="op">=</span> <span class="st">"r0.4"</span>, hem <span class="op">=</span> <span class="st">"L"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">gene_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:34, 1:6513] 0.469 0.607 0.512 0.341 0.664 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:34] "L_bankssts" "L_caudalanteriorcingulate" "L_caudalmiddlefrontal" "L_cuneus" ...</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:6513] "A1BG" "A1BG-AS1" "AACS" "AADAT" ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load-syngo-for-the-analysis">1.4. Load SynGO for the Analysis<a class="anchor" aria-label="anchor" href="#load-syngo-for-the-analysis"></a>
</h3>
<p>We will load SynGO terms that will be used in the enrichment
analysis. This data represents gene sets associated with various
molecular functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annoData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_annoData.html">get_annoData</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"SynGO"</span><span class="op">)</span></span>
<span><span class="va">geneSetList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_geneSetList.html">get_geneSetList</a></span><span class="op">(</span><span class="va">annoData</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geneSetList</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 302</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Number of SynGO terms: %d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">geneSetList</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of SynGO terms: 302"</span></span></code></pre></div>
<div class="section level4">
<h4 id="filter-the-genesetlist-optional">Filter the geneSetList (Optional)<a class="anchor" aria-label="anchor" href="#filter-the-genesetlist-optional"></a>
</h4>
<p>Filtering the gene sets by size is optional and is shown here for
demonstration purposes. This step is embedded in the
brainenrich/brainscore function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected.gs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_geneSetList.html">filter_geneSetList</a></span><span class="op">(</span>bg_genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">gene_data</span><span class="op">)</span>, geneSetList <span class="op">=</span> <span class="va">geneSetList</span>, minGSSize <span class="op">=</span> <span class="fl">20</span>, maxGSSize <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%d MF terms have gene size ranging between 20 and 200"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">selected.gs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="run-the-simulation-analysis">2. Run the Simulation Analysis<a class="anchor" aria-label="anchor" href="#run-the-simulation-analysis"></a>
</h2>
<p>In this section, we will run the enrichment analysis using the
prepared data. We permute the data in different ways and subsample it to
examine the false positive rate.</p>
<div class="section level3">
<h3 id="simulation-analysis-with-randomized-pred-variable-i-e--bmi-sim_type-randomize_pred">2.1. Simulation analysis with randomized pred variable i.e., BMI
(<code>sim_type ='randomize_pred'</code>)<a class="anchor" aria-label="anchor" href="#simulation-analysis-with-randomized-pred-variable-i-e--bmi-sim_type-randomize_pred"></a>
</h3>
<p>Note: Since the gene set scores are already calculated, randomizing
the predictor variable (BMI) offers limited information regarding the
false positive rate of individual scoring. Basically, it is testing the
false discovery rate of the correlation (i.e., lm model).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Sex</span><span class="op">)</span></span>
<span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.simulate.html">brainscore.simulate</a></span><span class="op">(</span></span>
<span>  pred_df <span class="op">=</span> <span class="va">pred_df</span>,</span>
<span>  cov_df <span class="op">=</span> <span class="va">cov_df</span>,</span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  sim_n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  subsample_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sim_type <span class="op">=</span> <span class="st">"randomize_pred"</span>,</span>
<span>  cor_method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  aggre_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ sim_1_subsample_100: tibble [55 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars           : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_1_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_1_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_2_subsample_100: tibble [55 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars           : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_2_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_2_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_3_subsample_100: tibble [55 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars           : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_3_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_3_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_4_subsample_100: tibble [55 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars           : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_4_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_4_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_5_subsample_100: tibble [55 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars           : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_5_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_5_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>The result is a list of lists, where each sublist contains the
significance testing results for each term, separately for both with and
without FDR correction. 1 denotes significant (p or fdr-p &lt; 0.05), 0
denotes non-significant. The results of fdr corrected p-values across
gene sets (Dependent_vars) are also available in the result list.
However, as we are expecting no significant resutls for each of gene set
(i.e., Dependent_var), FDR correction across gene sets could be
inappropriate.</p>
</div>
<div class="section level3">
<h3 id="simulation-analysis-with-spin_brain-sim_type-spin_brain">2.2. Simulation analysis with spin_brain
(<code>sim_type ='spin_brain'</code>)<a class="anchor" aria-label="anchor" href="#simulation-analysis-with-spin_brain-sim_type-spin_brain"></a>
</h3>
<p>We simulate the brain data by spinning it and then calculate the gene
set scores before correlating them with the predictor variable. Both
parametric and non-parametric tests (here, based on spin_brain) are
used.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Sex</span><span class="op">)</span></span>
<span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.simulate.html">brainscore.simulate</a></span><span class="op">(</span></span>
<span>  pred_df <span class="op">=</span> <span class="va">pred_df</span>,</span>
<span>  cov_df <span class="op">=</span> <span class="va">cov_df</span>,</span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  sim_n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  subsample_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sim_type <span class="op">=</span> <span class="st">"spin_brain"</span>,</span>
<span>  cor_method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  aggre_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  perm_id <span class="op">=</span> <span class="va">perm_id_dk_lh_5000</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ sim_1_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_1_subsample_100   : num [1:55] 0 0 0 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_1_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_1_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_1_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_2_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_2_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_2_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_2_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_2_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_3_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_3_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_3_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_3_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_3_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_4_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_4_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_4_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_4_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_4_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_5_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_5_subsample_100   : num [1:55] 0 0 0 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_5_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_5_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_5_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>The result is a list of lists, where each sublist contains the
significance testing results for each term, separately for both with and
without FDR correction. 1 denotes significant (p or fdr-p &lt; 0.05), 0
denotes non-significant. The results of fdr corrected p-values across
gene sets (Dependent_vars) are also available in the result list.
However, as we are expecting no significant resutls for each of gene set
(i.e., Dependent_var), FDR correction across gene sets could be
inappropriate. Two types of statistical tests are performed: parametric
(based on lm model itself; without “np”) and non-parametric (based on
the permutation of the brain data; with “np”). The permutation is done
by spinning the brain data.</p>
</div>
<div class="section level3">
<h3 id="simulation-analysis-with-spin_brain-sim_type-spin_brain-and-pre-calculated-null-gsscore">2.3. Simulation analysis with spin_brain
(<code>sim_type ='spin_brain'</code>) and pre-calculated null
gsScore<a class="anchor" aria-label="anchor" href="#simulation-analysis-with-spin_brain-sim_type-spin_brain-and-pre-calculated-null-gsscore"></a>
</h3>
<p>As generation the null gsScore is time-consuming, we can use the
pre-calculated null gsScore to speed up the simulation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pre-calculate the null gsScore</span></span>
<span><span class="va">gsScore.spin_brain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.html">brainscore</a></span><span class="op">(</span></span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  null_model <span class="op">=</span> <span class="st">"spin_brain"</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  perm_id <span class="op">=</span> <span class="va">perm_id_dk_lh_5000</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cov_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Sex</span><span class="op">)</span></span>
<span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.simulate.html">brainscore.simulate</a></span><span class="op">(</span></span>
<span>  pred_df <span class="op">=</span> <span class="va">pred_df</span>,</span>
<span>  cov_df <span class="op">=</span> <span class="va">cov_df</span>,</span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  gsScoreList.null <span class="op">=</span> <span class="va">gsScore.spin_brain</span>,</span>
<span>  sim_n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  subsample_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sim_type <span class="op">=</span> <span class="st">"spin_brain"</span>,</span>
<span>  cor_method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  aggre_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  perm_id <span class="op">=</span> <span class="va">perm_id_dk_lh_5000</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ sim_1_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_1_subsample_100   : num [1:55] 0 0 0 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_1_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_1_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_1_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_2_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_2_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_2_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_2_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_2_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_3_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_3_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_3_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_3_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_3_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_4_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_4_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_4_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_4_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_4_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_5_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_5_subsample_100   : num [1:55] 0 0 0 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_5_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_5_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_5_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>To ensure that the gsScore.spin_brain was generated with the same
parameters and can be used in the function, The attribute of
gsScore.spin_brain should match the following argument of the
brainscore.simulate: cor_method, aggre_method, n_perm, perm_id,
minGSSize, maxGSSize.</p>
</div>
<div class="section level3">
<h3 id="simulation-analysis-with-resample_gene-sim_type-resample_gene">2.4. Simulation analysis with resample_gene
(<code>sim_type ='resample_gene'</code>)<a class="anchor" aria-label="anchor" href="#simulation-analysis-with-resample_gene-sim_type-resample_gene"></a>
</h3>
<p>We simulate the gene sets by resampling genes and then calculate the
gene set scores before correlating them with the predictor variable.
Both parametric and non-parametric tests (here, based on resample_gene)
are used.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Sex</span><span class="op">)</span></span>
<span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.simulate.html">brainscore.simulate</a></span><span class="op">(</span></span>
<span>  pred_df <span class="op">=</span> <span class="va">pred_df</span>,</span>
<span>  cov_df <span class="op">=</span> <span class="va">cov_df</span>,</span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  sim_n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  subsample_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sim_type <span class="op">=</span> <span class="st">"resample_gene"</span>,</span>
<span>  cor_method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  aggre_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ sim_1_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_1_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_1_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_1_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_1_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_2_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_2_subsample_100   : num [1:55] 0 0 1 0 1 1 0 1 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_2_subsample_100     : num [1:55] 0 0 1 0 1 1 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_2_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_2_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_3_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_3_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_3_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_3_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_3_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_4_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_4_subsample_100   : num [1:55] 1 1 0 0 0 0 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_4_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_4_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_4_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_5_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_5_subsample_100   : num [1:55] 1 0 0 0 0 0 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_5_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_5_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_5_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>The result is a list of lists, where each sublist contains the
significance testing results for each term, separately for both with and
without FDR correction. 1 denotes significant (p or fdr-p &lt; 0.05), 0
denotes non-significant. The results of fdr corrected p-values across
gene sets (Dependent_vars) are also available in the result list.
However, as we are expecting no significant resutls for each of gene set
(i.e., Dependent_var), FDR correction across gene sets could be
inappropriate. Two types of statistical tests are performed: parametric
(based on lm model itself; without “np”) and non-parametric (based on
the permutation of gene sets; with “np”). The permutation is done by
spinning the brain data.</p>
</div>
<div class="section level3">
<h3 id="simulation-analysis-with-resample_gene-sim_type-resample_gene-and-pre-calculated-null-gsscore">2.5. Simulation analysis with resample_gene
(<code>sim_type ='resample_gene'</code>) and pre-calculated null
gsScore<a class="anchor" aria-label="anchor" href="#simulation-analysis-with-resample_gene-sim_type-resample_gene-and-pre-calculated-null-gsscore"></a>
</h3>
<p>As generation the null gsScore is time-consuming, we can use the
pre-calculated null gsScore to speed up the simulation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># pre-calculate the null gsScore</span></span>
<span><span class="va">gsScore.resample_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.html">brainscore</a></span><span class="op">(</span></span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  null_model <span class="op">=</span> <span class="st">"resample_gene"</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cov_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Age</span>, <span class="va">Sex</span><span class="op">)</span></span>
<span><span class="va">pred_df</span> <span class="op">&lt;-</span> <span class="va">sample_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">BMI</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/brainscore.simulate.html">brainscore.simulate</a></span><span class="op">(</span></span>
<span>  pred_df <span class="op">=</span> <span class="va">pred_df</span>,</span>
<span>  cov_df <span class="op">=</span> <span class="va">cov_df</span>,</span>
<span>  brain_data <span class="op">=</span> <span class="va">brain_data</span>,</span>
<span>  gene_data <span class="op">=</span> <span class="va">gene_data</span>,</span>
<span>  annoData <span class="op">=</span> <span class="va">annoData</span>,</span>
<span>  gsScoreList.null <span class="op">=</span> <span class="va">gsScore.resample_gene</span>,</span>
<span>  sim_n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  subsample_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  sim_type <span class="op">=</span> <span class="st">"resample_gene"</span>,</span>
<span>  cor_method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  aggre_method <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  n_perm <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  minGSSize <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxGSSize <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ sim_1_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_1_subsample_100   : num [1:55] 0 0 0 0 0 0 0 1 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_1_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_1_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_1_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_2_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_2_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 1 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_2_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_2_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_2_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_3_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_3_subsample_100   : num [1:55] 0 0 1 1 0 1 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_3_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_3_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_3_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_4_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_4_subsample_100   : num [1:55] 0 0 0 0 0 0 0 0 1 0 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_4_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_4_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_4_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;  $ sim_5_subsample_100: tibble [55 × 5] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ Dependent_vars              : chr [1:55] "GO:0007268" "GO:0007416" "GO:0008021" "GO:0016079" ...</span></span>
<span><span class="co">#&gt;   ..$ nofdr_sim_5_subsample_100   : num [1:55] 0 1 0 0 0 0 1 1 0 1 ...</span></span>
<span><span class="co">#&gt;   ..$ fdr_sim_5_subsample_100     : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_nofdr_sim_5_subsample_100: num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ np_fdr_sim_5_subsample_100  : num [1:55] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>Again, to ensure that the gsScore.resample_gene was generated with
the same parameters and can be used in the function, The attribute of
gsScore.resample_gene should match the following argument of the
brainscore.simulate: cor_method, aggre_method, n_perm, perm_id,
minGSSize, maxGSSize.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhipeng Cao.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
